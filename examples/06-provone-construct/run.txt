
******************************************* EXAMPLE SETUP ************************************************

# IMPORT SDTL AS JSON-LD

geist destroy --dataset kb --quiet
geist create --dataset kb --quiet 
geist import --format jsonld --file ../data/compute-sdth.jsonld

------------------------------------------- SETUP OUTPUTS ------------------------------------------------



******************************************* EXAMPLE E1 ************************************************

# EXPORT ORIGINAL SDTL AS N-TRIPLES

geist export --format nt --sort

------------------------------------------- E1 OUTPUTS ------------------------------------------------

<http://wholetale.org/program/1119/dataframe/1> <http://www.w3.org/1999/02/22-rdf-syntax-ns#type> <https://rdf-vocabulary.ddialliance.org/sdth#Dataframe> .
<http://wholetale.org/program/1119/dataframe/1> <https://rdf-vocabulary.ddialliance.org/sdth#hasName> "df"^^<http://www.w3.org/2001/XMLSchema#string> .
<http://wholetale.org/program/1119/dataframe/1> <https://rdf-vocabulary.ddialliance.org/sdth#includesVariable> <http://wholetale.org/program/1119/variable/1> .
<http://wholetale.org/program/1119/dataframe/1> <https://rdf-vocabulary.ddialliance.org/sdth#includesVariable> <http://wholetale.org/program/1119/variable/2> .
<http://wholetale.org/program/1119/file/1> <http://www.w3.org/1999/02/22-rdf-syntax-ns#type> <https://rdf-vocabulary.ddialliance.org/sdth#File> .
<http://wholetale.org/program/1119/file/1> <https://rdf-vocabulary.ddialliance.org/sdth#hasFormat> "csv"^^<http://www.w3.org/2001/XMLSchema#string> .
<http://wholetale.org/program/1119/file/1> <https://rdf-vocabulary.ddialliance.org/sdth#hasName> "inputs/df.csv"^^<http://www.w3.org/2001/XMLSchema#string> .
<http://wholetale.org/program/1119/file/2> <http://www.w3.org/1999/02/22-rdf-syntax-ns#type> <https://rdf-vocabulary.ddialliance.org/sdth#File> .
<http://wholetale.org/program/1119/file/2> <https://rdf-vocabulary.ddialliance.org/sdth#hasFormat> "csv"^^<http://www.w3.org/2001/XMLSchema#string> .
<http://wholetale.org/program/1119/file/2> <https://rdf-vocabulary.ddialliance.org/sdth#hasName> "df_updated.csv"^^<http://www.w3.org/2001/XMLSchema#string> .
<http://wholetale.org/program/1119/program/1> <http://www.w3.org/1999/02/22-rdf-syntax-ns#type> <https://rdf-vocabulary.ddialliance.org/sdth#Program> .
<http://wholetale.org/program/1119/program/1> <https://rdf-vocabulary.ddialliance.org/sdth#hasProgramStep> <http://wholetale.org/program/1119/step/1> .
<http://wholetale.org/program/1119/program/1> <https://rdf-vocabulary.ddialliance.org/sdth#hasProgramStep> <http://wholetale.org/program/1119/step/8> .
<http://wholetale.org/program/1119/step/1> <http://www.w3.org/1999/02/22-rdf-syntax-ns#type> <https://rdf-vocabulary.ddialliance.org/sdth#ProgramStep> .
<http://wholetale.org/program/1119/step/1> <https://rdf-vocabulary.ddialliance.org/sdth#assignsVariable> <http://wholetale.org/program/1119/variable/1> .
<http://wholetale.org/program/1119/step/1> <https://rdf-vocabulary.ddialliance.org/sdth#assignsVariable> <http://wholetale.org/program/1119/variable/2> .
<http://wholetale.org/program/1119/step/1> <https://rdf-vocabulary.ddialliance.org/sdth#hasSourceCode> "df = pd.read_csv('inputs/df.csv')"^^<http://www.w3.org/2001/XMLSchema#string> .
<http://wholetale.org/program/1119/step/1> <https://rdf-vocabulary.ddialliance.org/sdth#loadsFile> <http://wholetale.org/program/1119/file/1> .
<http://wholetale.org/program/1119/step/1> <https://rdf-vocabulary.ddialliance.org/sdth#producesDataframe> <http://wholetale.org/program/1119/dataframe/1> .
<http://wholetale.org/program/1119/step/8> <http://www.w3.org/1999/02/22-rdf-syntax-ns#type> <https://rdf-vocabulary.ddialliance.org/sdth#ProgramStep> .
<http://wholetale.org/program/1119/step/8> <https://rdf-vocabulary.ddialliance.org/sdth#consumesDataframe> <http://wholetale.org/program/1119/dataframe/1> .
<http://wholetale.org/program/1119/step/8> <https://rdf-vocabulary.ddialliance.org/sdth#hasSourceCode> "df.to_csv('outputs/df_updated.csv', index=False)"^^<http://www.w3.org/2001/XMLSchema#string> .
<http://wholetale.org/program/1119/step/8> <https://rdf-vocabulary.ddialliance.org/sdth#savesFile> <http://wholetale.org/program/1119/file/2> .
<http://wholetale.org/program/1119/step/8> <https://rdf-vocabulary.ddialliance.org/sdth#usesVariable> <http://wholetale.org/program/1119/variable/1> .
<http://wholetale.org/program/1119/step/8> <https://rdf-vocabulary.ddialliance.org/sdth#usesVariable> <http://wholetale.org/program/1119/variable/2> .
<http://wholetale.org/program/1119/variable/1> <http://www.w3.org/1999/02/22-rdf-syntax-ns#type> <stdh:Variable> .
<http://wholetale.org/program/1119/variable/1> <https://rdf-vocabulary.ddialliance.org/sdth#hasName> "A"^^<http://www.w3.org/2001/XMLSchema#string> .
<http://wholetale.org/program/1119/variable/2> <http://www.w3.org/1999/02/22-rdf-syntax-ns#type> <https://rdf-vocabulary.ddialliance.org/sdth#Variable> .
<http://wholetale.org/program/1119/variable/2> <https://rdf-vocabulary.ddialliance.org/sdth#hasName> "B"^^<http://www.w3.org/2001/XMLSchema#string> .


******************************************* EXAMPLE R1 ************************************************

# CONSTRUCT PROVONE PROGRAMS

(
geist report << '__END_REPORT_TEMPLATE__'

    {{{
        {{ include "../common/sdth.g" }}
    }}}
                                                                                        \
    {{ range $T := (sdth_construct_provone_program_triples | rows) }}                   \
        {{ ntriple_print $T }}
    {{ end }}                                                                                                                                                                   \
__END_REPORT_TEMPLATE__
) | sort

------------------------------------------- R1 OUTPUTS ------------------------------------------------

<http://wholetale.org/program/1119/program/1> <http://www.w3.org/1999/02/22-rdf-syntax-ns#type> <http://purl.dataone.org/provone/2015/01/15/ontology#Program> .
<http://wholetale.org/program/1119/step/1> <http://www.w3.org/1999/02/22-rdf-syntax-ns#type> <http://purl.dataone.org/provone/2015/01/15/ontology#Program> .
<http://wholetale.org/program/1119/step/8> <http://www.w3.org/1999/02/22-rdf-syntax-ns#type> <http://purl.dataone.org/provone/2015/01/15/ontology#Program> .


******************************************* EXAMPLE R2 ************************************************

# CONSTRUCT PROVONE HASSUBPROGRAM TRIPLES

(
geist report << '__END_REPORT_TEMPLATE__'

    {{{
        {{ include "../common/sdth.g" }}
    }}}
                                                                            \
    {{ range $Program := select_sdth_program | vector }}                    \
        {{ range $Step := (select_sdth_program_steps $Program | vector) }}  \
            {{uri $Program}} provone:hasSubProgram {{uri $Step}} .
        {{ end }}                                                           \
    {{ end }}                                                               \
                                                                            \
__END_REPORT_TEMPLATE__
) | sort

------------------------------------------- R2 OUTPUTS ------------------------------------------------

<http://wholetale.org/program/1119/program/1> provone:hasSubProgram <http://wholetale.org/program/1119/step/1> .
<http://wholetale.org/program/1119/program/1> provone:hasSubProgram <http://wholetale.org/program/1119/step/8> .


******************************************* EXAMPLE R3 ************************************************

# CONSTRUCT DATAFRAME PORTS

(
geist report << '__END_REPORT_TEMPLATE__'

    {{{
        {{ include "../common/sdth.g" }}
    }}}
                                                                                \
    {{ range $DataframeProducer := (select_dataframe_producers | rows) }}       \
        {{ with $StepId := (index $DataframeProducer 0) }}                      \
        {{ with $DataframeId := (index $DataframeProducer 1) }}                 \
        {{ with $DataframeName := (index $DataframeProducer 2) }}               \
        {{ with $PortId := (dataframe_out_port_id $StepId $DataframeName) }}    \
            {{uri $StepId}} provone:hasOutPort {{uri $PortId}} .
            {{uri $PortId }} sdth:hasDataframe {{uri $DataframeId}} .
        {{ end }}                                                               \
        {{ end }}                                                               \
        {{ end }}                                                               \
        {{ end }}                                                               \
    {{ end }}                                                                   \

    {{ range $DataframeConsumer := (select_dataframe_consumers | rows) }}       \
        {{ with $StepId := (index $DataframeConsumer 0) }}                      \
        {{ with $DataframeId := (index $DataframeConsumer 1) }}                 \
        {{ with $DataframeName := (index $DataframeConsumer 2) }}               \
        {{ with $PortId := (dataframe_in_port_id $StepId $DataframeName) }}     \
            {{uri $StepId }} provone:hasInPort {{uri $PortId}} .
            {{uri $PortId }} sdth:hasDataframe {{uri $DataframeId}} .
        {{ end }}                                                               \
        {{ end }}                                                               \
        {{ end }}                                                               \
        {{ end }}                                                               \
    {{ end }}                                                                   \
                                                                                \
__END_REPORT_TEMPLATE__
) | sort

------------------------------------------- R3 OUTPUTS ------------------------------------------------


<http://wholetale.org/program/1119/step/1/dataframeport/df_out> sdth:hasDataframe <http://wholetale.org/program/1119/dataframe/1> .
<http://wholetale.org/program/1119/step/1> provone:hasOutPort <http://wholetale.org/program/1119/step/1/dataframeport/df_out> .
<http://wholetale.org/program/1119/step/8/dataframeport/df_in> sdth:hasDataframe <http://wholetale.org/program/1119/dataframe/1> .
<http://wholetale.org/program/1119/step/8> provone:hasInPort <http://wholetale.org/program/1119/step/8/dataframeport/df_in> .


******************************************* EXAMPLE R3 ************************************************

# CONSTRUCT VARIABLE PORTS

(
geist report << '__END_REPORT_TEMPLATE__'

    {{{
        {{ include "../common/sdth.g" }}
    }}}
                                                                        \
    {{ range $VarProducer := (select_variable_producers | rows) }}      \
        {{ with $StepId := (index $VarProducer 0) }}                    \                   
        {{ with $VarId := (index $VarProducer 1) }}                     \
        {{ with $VarName := (index $VarProducer 2) }}                   \
        {{ with $PortId := (var_out_port_id $StepId $VarName) }}        \
            {{uri $StepId}} provone:hasOutPort {{uri $PortId}} .  
            {{uri $PortId }} sdth:hasVariable {{uri $VarId}} .
        {{ end }}                                                       \
        {{ end }}                                                       \
        {{ end }}                                                       \
        {{ end }}                                                       \
    {{ end }}                                                           \

    {{ range $VarConsumer := (select_variable_consumers | rows) }}      \
        {{ with $StepId := (index $VarConsumer 0) }}                    \
        {{ with $VarId := (index $VarConsumer 1) }}                     \
        {{ with $VarName := (index $VarConsumer 2) }}                   \
        {{ with $PortId := (var_in_port_id $StepId $VarName) }}         \
            {{uri $StepId}} provone:hasInPort {{uri $PortId}} .  
            {{uri $PortId}} sdth:hasVariable {{uri $VarId}} .
        {{ end }}                                                       \
        {{ end }}                                                       \
        {{ end }}                                                       \
        {{ end }}                                                       \
    {{ end }}                                                           \
                                                                        \
__END_REPORT_TEMPLATE__
) | sort

------------------------------------------- R3 OUTPUTS ------------------------------------------------


<http://wholetale.org/program/1119/step/1/variableport/A_out> sdth:hasVariable <http://wholetale.org/program/1119/variable/1> .
<http://wholetale.org/program/1119/step/1/variableport/B_out> sdth:hasVariable <http://wholetale.org/program/1119/variable/2> .
<http://wholetale.org/program/1119/step/1> provone:hasOutPort <http://wholetale.org/program/1119/step/1/variableport/A_out> .
<http://wholetale.org/program/1119/step/1> provone:hasOutPort <http://wholetale.org/program/1119/step/1/variableport/B_out> .
<http://wholetale.org/program/1119/step/8/variableport/A_in> sdth:hasVariable <http://wholetale.org/program/1119/variable/1> .
<http://wholetale.org/program/1119/step/8/variableport/B_in> sdth:hasVariable <http://wholetale.org/program/1119/variable/2> .
<http://wholetale.org/program/1119/step/8> provone:hasInPort <http://wholetale.org/program/1119/step/8/variableport/A_in> .
<http://wholetale.org/program/1119/step/8> provone:hasInPort <http://wholetale.org/program/1119/step/8/variableport/B_in> .


******************************************* EXAMPLE R4 ************************************************

# CONSTRUCT DATAFRAME CHANNELS

(
geist report << '__END_REPORT_TEMPLATE__'

    {{{
        {{ include "../common/sdth.g" }}
    }}}
                                                                                        \
    {{ range $ChannelIndex, $DataframeChannel := (select_dataframe_channels | rows) }}  \
        {{ with $WorkflowId := (index $DataframeChannel 0) }}                           \
        {{ with $DataframeName := (index $DataframeChannel 1) }}                        \
        {{ with $OutStepId := (index $DataframeChannel 2) }}                            \
        {{ with $InStepId := (index $DataframeChannel 3) }}                             \
        {{ with $ChannelId := (dataframe_channel_id $OutStepId (printf "%d" $ChannelIndex)) }}    \
        {{ with $OutPortId := (dataframe_out_port_id $OutStepId $DataframeName) }}      \
        {{ with $InPortId := (dataframe_in_port_id $InStepId $DataframeName) }}         \
            {{uri $OutPortId}} provone:connectsTo {{$ChannelId}} .
            {{uri $InPortId}} provone:connectsTo {{$ChannelId}} .
        {{ end }}                                                                       \
        {{ end }}                                                                       \
        {{ end }}                                                                       \
        {{ end }}                                                                       \
        {{ end }}                                                                       \
        {{ end }}                                                                       \
        {{ end }}                                                                       \
    {{ end }}                                                                           \

__END_REPORT_TEMPLATE__
) | sort

------------------------------------------- R4 OUTPUTS ------------------------------------------------


<http://wholetale.org/program/1119/step/1/dataframeport/df_out> provone:connectsTo http://wholetale.org/program/1119/step/1/dataframechannel/0 .
<http://wholetale.org/program/1119/step/8/dataframeport/df_in> provone:connectsTo http://wholetale.org/program/1119/step/1/dataframechannel/0 .

